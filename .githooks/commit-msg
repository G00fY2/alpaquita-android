#!/bin/bash

# 1. Get header and message
msg_file=$1
header=$(head -n 1 "$msg_file")

# 2. Strict Regex (Type-Enum, Lowercase, No Empty Subject)
pattern="^(build|chore|ci|docs|feat|fix|perf|refactor|revert|style|test)(\(.+\))?(!)?: [a-z0-9].+"

if [[ ! "$header" =~ $pattern ]] || [ ${#header} -gt 100 ] || [[ "$header" =~ \.$ ]]; then
    echo "--------------------------------------------------------"
    echo "❌ COMMIT REJECTED"
    echo "Rule violations found:"
    echo "- Must use: feat, fix, ci, chore, refactor, etc. (lowercase)"
    echo "- Subject must not start with Uppercase or end with a dot"
    echo "- Header length must be <= 100 chars"
    echo "--------------------------------------------------------"
    exit 1
fi

# 3. Ensure blank line before body
if [ "$(wc -l < "$msg_file")" -gt 1 ] && [ -n "$(sed -n '2p' "$msg_file")" ]; then
    echo "❌ Error: Please provide a blank line before the commit body."
    exit 1
fi
